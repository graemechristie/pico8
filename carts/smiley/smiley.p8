pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
player={ sprite = 0, x = 64, y = 64 , attack = {} }
h=112
w=128
timer5=0


debug=false

function _init()

end

function _update()
  timer5-=1
  player.attack = {}
  if (btn(0) and not cboth(player.x-1, player.y)) then player.x=player.x-1 end
  if (btn(1) and not cboth(player.x+1, player.y)) then player.x=player.x+1 end
  if (btn(2) and not cboth(player.x, player.y-1)) then player.y=player.y-1 end
  if (btn(3) and not cboth(player.x, player.y+1)) then player.y=player.y+1 end
  if (btn(0) and btn(4) and not cbounds(player.x-1,player.y)) then player.attack = { sprite=48, flip_x = true,  flip_y=false, x=-6, y=4 } end
  if (btn(1) and btn(4) and not cbounds(player.x+1,player.y)) then player.attack = { sprite=48, flip_x = false, flip_y=false, x=14, y=4 } end
  if (btn(2) and btn(4) and not cbounds(player.x,player.y+1)) then player.attack = { sprite=49, flip_x = false, flip_y=false, x=4, y=-6 } end
  if (btn(3) and btn(4) and not cbounds(player.x,player.y+1)) then player.attack = { sprite=49, flip_x = false, flip_y=true, x=4, y=14 } end
  if (btn(5) and timer5 < 0) then 
    player.sprite = player.sprite+2 
    timer5=10  
  end

  if (player.sprite > 6) then player.sprite=0 end

end

function _draw()
  map(0,0,0,0,16,14)
  spr(player.sprite, player.x, player.y,2,2)
  
  rectfill(0,112,128,128,0)

  for y=0,0 do
    for x=0,6,2 do
      spr(x+(y*16), x*8, 113+(y*8),2,2)
    end
  end
      
  local selectedx=(player.sprite % 8)*8
  local selectedy=(player.sprite > 16) and 121 or 113

  rect(selectedx, selectedy, selectedx+16, selectedy+16, 15)

  if (next(player.attack) != nil) then
    spr(player.attack.sprite, player.x + player.attack.x, player.y + player.attack.y, 1, 1, player.attack.flip_x, player.attack.flip_y)
  end

  if (debug) then
    print("flags: "..fget(mget(player.x/8, player.y/8)), 8, 2)
    print("sprite: "..mget(player.x/8, player.y/8), 64, 2)
  end

end

function cmap(x,y)
  local ct=false
  local x1=x/8
  local y1=y/8
  local x2=(x+7)/8
  local y2=(y+7)/8
  local a=fget(mget(x1,y1),0)
  local b=fget(mget(x1,y2),0)
  local c=fget(mget(x2,y2),0)
  local d=fget(mget(x2,y1),0)
  return a or b or c or d   
end

function cbounds(x,y)
  return (x<0 or x+8>w or y<0 or y+8>h)
end

function cboth(x,y)
  return cmap(x,y) or cbounds(x,y)
end


__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000008888800000000000000000300000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000008888800000000000003333033000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000bbbb00000000000088ffff00000000003f8833380000000000000000000000000000000000000000000000000000000000000000000
000000899980000000000b00bbbb00000000088fcfc00000000000f8858580000000000000000000000000000000000000000000000000000000000000000000
000009959599000000000b0bbbbbb00000000887fff0000000000078685680000000000000000000000000000000000000000000000000000000000000000000
000009799979000000000b08585800000000000f77700000000000f8888877000000000000000000000000000000000000000000000000000000000000000000
00000987778900000000000875780000000000cccccc8000000000c8888778000000000000000000000000000000000000000000000000000000000000000000
00000889998800000000000878780000000000c8cccc800000000087777780000000000000000000000000000000000000000000000000000000000000000000
000000090900000000000008888980000000008c8111c80000000008888888000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000088999880000000008881818800000000888888800000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000888888800000000008881818800000008888888800000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000001010000000088808888800000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000888808888000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3b3b3b3b44444444bbbbbbbb00000333bbbbbbb30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b3b3b3b344444444bbbbbbbb000033bbb33bb3330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3b3b3b3b44444444bbbbbbbb0033bbbb33333bbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b3b3b3b344444444bbbbbbbb033bb333bbb33bbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444444444444bbbbbbbb33bb33bbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444444444444bbbbbbbbbbb3bbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444444444444bbbbbbbbbb3bbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444444444444bbbbbbbbb3bbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000000001010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
3a23222222222222222222222222222222222222222222220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2322222222222222222222222222222222222222222222221b1b1b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020202020202020202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2121212121212121212121212121212121212121212121210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2121212121212121212121212121212121212121212121210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2121212121212121212121212121212121212121212121210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2121212121212121212121212121212121212121212121210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2121212121212121212121212121212121212121212121210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2121212121212121212121212121212121212121212121210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2121212121212121212121212121212121212121212121210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2121212121212121212121212121212121212121212121210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2121212121212121212121212121212121212121212121210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2121212121212121212121212121212121212121212121210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2121212121212121212121212121212121212121212121210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2121212121212121212121212121212121212121212121210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2121212121212121212121212121212121212121212121210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2121212121212121212121212121212121212121212121210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
